---
title: "Math230 Dashboard"
author: "Alex Searle, Justin Verlin, Jean Marie Ngabonziza"
output: 
  flexdashboard::flex_dashboard:
    runtime: shiny
    orientation: columns
    vertical_layout: fill
---

```{r}
library(shiny)
library(ggplot2)
library(Lock5Data)

```

Column
-------------------------------------
    
### Chart 1

```{r}
# Dataset selector
selectInput("dataset_choice", "Select a dataset:",
            choices = c("BodyTemp50", "CommuteAtlanta", "SleepStudy", "StudentSurvey"),
            selected = "BodyTemp50")

# Population histogram
plotOutput("popPlot", height = "100")

```


Column {.tabset}
-------------------------------------
   
### Chart 2

```{r}
# Sample size slider
fluidRow(
  column(4,
    sliderInput("n", "Sample Size (n):", min = 10, max = 1000, value = 10, step = 20),
    
    plotOutput("sampleDistPlot", height = "300px"),  # Adjust height as needed
    
    plotOutput("qqPlot", height = "300px", width = "100%")  # Use width = "100%" to adapt to parent container
  )
    
)

```


### Chart 3

```{}
# Alex Searle
```


```{r}
# Server logic

# Reactive for selected dataset's numeric variable
selected_var <- reactive({
  data <- get(input$dataset_choice, "package:Lock5Data")
  
  switch(input$dataset_choice,
         "BodyTemp50" = data$BodyTemp,
         "CommuteAtlanta" = data$CommuteTime,
         "SleepStudy" = data$ExtraSleep,
         "StudentSurvey" = data$Height,
         NULL)
})

# Population plot
output$popPlot <- renderPlot({
  var <- selected_var()
  ggplot(data.frame(x = var), aes(x = x)) +
    geom_histogram(binwidth = 0.25, fill = "#1f77b4", color = "white") +
    geom_vline(aes(xintercept = mean(x, na.rm = TRUE)), 
               color = "red", linetype = "dashed", linewidth = 1) +
    labs(title = paste("Population Histogram of", input$dataset_choice),
         x = "Value", y = "Frequency") +
    theme_minimal()
}, height = 300, width = 400)

# Sample means reactive
sample_means <- reactive({
  var <- selected_var()
  num_samples <- 1000
  sample_size <- input$n
  
  sm <- numeric(num_samples)
  for (i in 1:num_samples) {
    sample_data <- sample(var, size = sample_size, replace = TRUE)
    sm[i] <- mean(sample_data, na.rm = TRUE)
  }
  sm
})

# Sampling distribution plot
output$sampleDistPlot <- renderPlot({
  sm <- sample_means()
  ggplot(data.frame(sm = sm), aes(x = sm)) +
    geom_histogram(bins = 30, fill = "#EE7623", color = "white") +
    geom_vline(xintercept = mean(sm), col = "black", linewidth = 0.8) +
    labs(title = paste("Sampling Distribution of the Mean (n =", input$n, ")"),
         x = "Sample Mean", y = "Frequency") +
    theme_minimal()
},height = 300, width = 400)

# QQ plot of sample means
output$qqPlot <- renderPlot({
  sm <- sample_means()  # get the vector of sample means
  
  qqnorm(sm, main = "QQ-Plot of Sample Means")
  qqline(sm, col = "#003865", lwd = 2)
}, height = 300, width = 400)


```


